<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario y Ventas de Ropa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --color-primary: #3b82f6;
            --color-secondary: #10b981;
        }
        
        .dark {
            --bg-color: #1f2937;
            --text-color: #f3f4f6;
            --card-bg: #374151;
            --input-bg: #4b5563;
            --border-color: #4b5563;
        }

        html {
            transition: background-color 0.3s, color 0.3s;
            background-color: #f3f4f6;
            color: #1f2937;
        }

        .dark html {
             background-color: var(--bg-color);
             color: var(--text-color);
        }

        .tab-active {
            border-bottom: 4px solid var(--color-primary);
            color: var(--color-primary);
            font-weight: 600;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        
        #notificaciones {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 300px;
        }
        .notificacion-item {
            padding: 12px 20px;
            margin-bottom: 10px;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            transition: opacity 0.5s ease-out;
        }
        .bg-success { background-color: #10b981; color: white; }
        .bg-error { background-color: #ef4444; color: white; }
        .bg-info { background-color: #3b82f6; color: white; }
        
        @media (max-width: 768px) {
            .tabla-container table, .tabla-container thead, .tabla-container tbody, .tabla-container th, .tabla-container td, .tabla-container tr { 
                display: block; 
            }
            .tabla-container thead tr { 
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            .tabla-container tr { border: 1px solid #4b5563; margin-bottom: 10px; }
            .tabla-container td { 
                border: none;
                border-bottom: 1px solid #e5e7eb; 
                position: relative;
                padding-left: 50%;
                text-align: right;
            }
            .tabla-container td:before { 
                position: absolute;
                top: 6px;
                left: 6px;
                width: 45%; 
                padding-right: 10px; 
                white-space: nowrap;
                content: attr(data-label);
                font-weight: bold;
                text-align: left;
            }
        }
    </style>
</head>
<body class="min-h-screen font-sans antialiased transition-colors duration-300">

<div id="login-modal" class="modal">
    <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl max-w-md w-full">
        <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-white">Inicio de Sesi贸n</h2>
        <p class="mb-6 text-gray-600 dark:text-gray-400">Ingrese la contrase帽a para acceder al sistema.</p>
        
        <form id="form-login" class="space-y-4">
            <div>
                <label for="password-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Contrase帽a</label>
                <input type="password" id="password-input" required placeholder="Ingrese su contrase帽a" 
                        class="mt-1 w-full p-3 border rounded-lg shadow-sm bg-gray-50 dark:bg-gray-700 dark:text-white dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <button type="submit" class="w-full py-3 rounded-lg shadow-md font-semibold transition duration-200 bg-blue-600 hover:bg-blue-700 text-white">
                Acceder
            </button>
        </form>
    </div>
</div>

<div id="edit-modal" class="modal hidden">
    <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl max-w-lg w-full">
        <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-white">Editar Producto</h2>
        
        <form id="form-editar-producto" class="space-y-4">
            <input type="hidden" id="edit-id">

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="edit-codigo" class="block text-sm font-medium text-gray-700 dark:text-gray-300">C贸digo</label>
                    <input type="text" id="edit-codigo" disabled 
                           class="mt-1 w-full p-3 border rounded-lg shadow-sm bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:border-gray-600">
                </div>
                <div>
                    <label for="edit-talla" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Talla</label>
                    <select id="edit-talla" required class="mt-1 w-full p-3 border rounded-lg shadow-sm bg-gray-50 dark:bg-gray-700 dark:text-white dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Seleccionar Talla</option>
                        <optgroup label="Ropa">
                            <option>XS</option><option>S</option><option>M</option><option>L</option><option>XL</option><option>U</option>
                        </optgroup>
                        <optgroup label="Calzado (EU)">
                            <option>32</option><option>33</option><option>34</option><option>35</option><option>36</option>
                            <option>37</option><option>38</option><option>39</option><option>40</option><option>41</option>
                            <option>42</option><option>43</option><option>44</option><option>45</option><option>46</option>
                            <option>47</option><option>48</option>
                        </optgroup>
                    </select>
                </div>
            </div>

            <div>
                <label for="edit-nombre" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Nombre</label>
                <input type="text" id="edit-nombre" required 
                        class="mt-1 w-full p-3 border rounded-lg shadow-sm bg-gray-50 dark:bg-gray-700 dark:text-white dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="edit-color" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Color</label>
                    <input type="text" id="edit-color" required 
                           class="mt-1 w-full p-3 border rounded-lg shadow-sm bg-gray-50 dark:bg-gray-700 dark:text-white dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="edit-precio" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Precio ($)</label>
                    <input type="number" id="edit-precio" min="0" step="0.01" required 
                           class="mt-1 w-full p-3 border rounded-lg shadow-sm bg-gray-50 dark:bg-gray-700 dark:text-white dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500">
                </div>
            </div>

            <div>
                <label for="edit-cantidad" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Cantidad (Stock)</label>
                <input type="number" id="edit-cantidad" min="0" required 
                        class="mt-1 w-full p-3 border rounded-lg shadow-sm bg-gray-50 dark:bg-gray-700 dark:text-white dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500">
            </div>

            <div class="flex justify-end space-x-3 pt-4">
                <button type="button" onclick="hideEditModal()" class="py-2 px-4 rounded-lg shadow-md font-semibold transition duration-200 bg-gray-300 hover:bg-gray-400 text-gray-800 dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-white">
                    Cancelar
                </button>
                <button type="submit" class="py-2 px-4 rounded-lg shadow-md font-semibold transition duration-200 bg-blue-600 hover:bg-blue-700 text-white">
                    Guardar Cambios
                </button>
            </div>
        </form>
    </div>
</div>


<div id="notificaciones" class="notificaciones"></div>

<header class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
        <h1 class="text-2xl font-extrabold text-blue-600 dark:text-blue-400">GIOR & CO.</h1>
        <div class="flex items-center space-x-4">
            <span id="current-user-info" class="text-sm font-semibold text-gray-700 dark:text-gray-300"></span>
            <div class="switch select-none flex items-center p-2 rounded-full cursor-pointer bg-gray-100 dark:bg-gray-700" id="toggle-dark" title="Modo oscuro">
                <span class="dot w-4 h-4 rounded-full bg-blue-500 dark:bg-yellow-400 mr-2 transition-all duration-300"></span>
                <span id="dark-mode-label" class="text-sm font-medium text-gray-700 dark:text-gray-300">Dark</span>
            </div>
            <button onclick="showLoginModal()" class="py-1 px-3 bg-gray-200 dark:bg-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-500 transition">
                Cerrar Sesi贸n
            </button>
        </div>
    </div>
    
    <nav class="bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex space-x-4">
            <button id="tab-inventario" data-tab="inventario" class="tab-button py-3 px-4 text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition duration-150 ease-in-out border-b-4 border-transparent tab-active">
                 Inventario
            </button>
            <button id="tab-ventas" data-tab="ventas" class="tab-button py-3 px-4 text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition duration-150 ease-in-out border-b-4 border-transparent">
                 Registro de Ventas
            </button>
        </div>
    </nav>
</header>

<main id="app-content" class="p-4 md:p-8 space-y-8 hidden">
    
    <div id="module-inventario" class="tab-content max-w-7xl mx-auto space-y-8">

        <section id="dashboard" class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="card bg-white dark:bg-gray-700 p-5 rounded-xl shadow-lg border-b-4 border-blue-500 dark:border-blue-400">
                <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-300">Total de productos</h3>
                <p id="stat-total" class="text-3xl font-bold mt-1 text-gray-800 dark:text-white">0</p>
            </div>
            
            <div class="card bg-white dark:bg-gray-700 p-5 rounded-xl shadow-lg border-b-4 border-red-500 dark:border-red-400">
                <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-300">Productos agotados</h3>
                <p id="stat-agotados" class="text-3xl font-bold mt-1 text-gray-800 dark:text-white">0</p>
            </div>
            
            <div class="card bg-white dark:bg-gray-700 p-5 rounded-xl shadow-lg border-b-4 border-amber-500 dark:border-amber-400">
                <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-300">Stock bajo (&le; 5)</h3>
                <p id="stat-bajo" class="text-3xl font-bold mt-1 text-gray-800 dark:text-white">0</p>
            </div>

            <div class="card bg-white dark:bg-gray-700 p-5 rounded-xl shadow-lg border-b-4 border-emerald-500 dark:border-emerald-400">
                <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-300">Valor total inventario</h3>
                <p id="stat-valor" class="text-3xl font-bold mt-1 text-gray-800 dark:text-white">$0</p>
            </div>
        </section>

        <div id="inventory-charts-section" class="charts grid grid-cols-1 lg:grid-cols-2 gap-6 hidden">
            <div class="chart-card bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg">
                <h4 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Estado de stock</h4>
                <div style="height:250px;">
                    <canvas id="chart-stock-pie"></canvas>
                </div>
            </div>

            <div class="chart-card bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg">
                <h4 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Top 5 Productos M谩s Vendidos (Stock Actual)</h4>
                <div style="height:250px;">
                    <canvas id="chart-top-bar"></canvas>
                </div>
            </div>
        </div>

        <section id="add-product-section" class="form-container bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg">
            <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">Agregar Producto</h2>
            <form id="form-producto" class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <input type="text" id="codigo" required placeholder="C贸digo" class="p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500">
                <input type="text" id="nombre" required placeholder="Nombre" class="p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500">
                <select id="talla" required class="p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500">
                    <option value="">Talla</option>
                    <optgroup label="Ropa">
                        <option>XS</option><option>S</option><option>M</option><option>L</option><option>XL</option><option>U</option>
                    </optgroup>
                    <optgroup label="Calzado (EU)">
                        <option>32</option><option>33</option><option>34</option><option>35</option><option>36</option>
                        <option>37</option><option>38</option><option>39</option><option>40</option><option>41</option>
                        <option>42</option><option>43</option><option>44</option><option>45</option><option>46</option>
                        <option>47</option><option>48</option>
                    </optgroup>
                </select>
                <input type="text" id="color" required placeholder="Color" class="p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500">
                <input type="number" id="cantidad" min="1" required placeholder="Cantidad" class="p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500">
                <input type="number" id="precio" min="0" step="0.01" required placeholder="Precio ($)" class="p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500">
                <div class="sm:col-span-3 pt-2">
                    <button type="submit" class="btn-agregar w-full py-2 px-4 rounded-md shadow-md text-white bg-blue-600 hover:bg-blue-700 transition">
                        Agregar Producto
                    </button>
                </div>
            </form>
        </section>

        <section class="filtros-container bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg">
            <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">Filtros de Inventario</h2>
            <div class="filtro-buscar mb-4">
                <input type="search" id="buscar" placeholder="Buscar por c贸digo o nombre..." class="w-full p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500" />
            </div>

            <div class="filtro-controles grid grid-cols-2 md:grid-cols-6 gap-4 items-end">
                <select id="filtro-talla" class="p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500">
                    <option value="">Talla</option>
                    <optgroup label="Ropa">
                        <option value="XS">XS</option><option value="S">S</option><option value="M">M</option><option value="L">L</option><option value="XL">XL</option><option value="U">U</option>
                    </optgroup>
                    <optgroup label="Calzado (EU)">
                        <option value="32">32</option><option value="33">33</option><option value="34">34</option><option value="35">35</option><option value="36">36</option>
                        <option value="37">37</option><option value="38">38</option><option value="39">39</option><option value="40">40</option><option value="41">41</option>
                        <option value="42">42</option><option value="43">43</option><option value="44">44</option><option value="45">45</option><option value="46">46</option>
                        <option value="47">47</option><option value="48">48</option>
                    </optgroup>
                </select>
                <input type="text" id="filtro-color" placeholder="Color" class="p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500" />
                <select id="filtro-stock" class="p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500"><option value="">Stock</option><option value="agotado">Agotado</option><option value="bajo">Bajo</option><option value="ok">OK</option></select>
                <input type="number" id="filtro-precio-min" min="0" placeholder="Precio min" class="p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500" />
                <input type="number" id="filtro-precio-max" min="0" placeholder="Precio max" class="p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500" />
                <button id="limpiar-filtros" class="btn-limpiar w-full py-2 px-4 rounded-md shadow-md text-white bg-gray-500 hover:bg-gray-600 transition">
                    Limpiar
                </button>
            </div>
        </section>

        <section class="tabla-container bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg overflow-x-auto">
            <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">Lista de Inventario</h2>
            <table id="tabla-inventario" class="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
                <thead class="bg-gray-50 dark:bg-gray-800">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs text-gray-500 dark:text-gray-300 uppercase tracking-wider">C贸digo</th>
                        <th class="px-6 py-3 text-left text-xs text-gray-500 dark:text-gray-300 uppercase tracking-wider">Nombre</th>
                        <th class="px-6 py-3 text-left text-xs text-gray-500 dark:text-gray-300 uppercase tracking-wider">Talla</th>
                        <th class="px-6 py-3 text-left text-xs text-gray-500 dark:text-gray-300 uppercase tracking-wider">Color</th>
                        <th class="px-6 py-3 text-right text-xs text-gray-500 dark:text-gray-300 uppercase tracking-wider">Cantidad</th>
                        <th class="px-6 py-3 text-right text-xs text-gray-500 dark:text-gray-300 uppercase tracking-wider">Precio</th>
                        <th id="acciones-header" class="px-6 py-3 text-center text-xs text-gray-500 dark:text-gray-300 uppercase tracking-wider">Acciones</th>
                    </tr>
                </thead>
                <tbody class="bg-white dark:bg-gray-700 divide-y divide-gray-200 dark:divide-gray-600">
                </tbody>
            </table>
        </section>
    </div>

    <div id="module-ventas" class="tab-content hidden max-w-7xl mx-auto space-y-8">
        
        <section class="form-container bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg">
            <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">Registrar Nueva Venta</h2>
            
            <form id="form-venta" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="venta-producto" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Producto (C贸digo - Nombre)</label>
                        <select id="venta-producto" required class="mt-1 w-full p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500">
                            <option value="">Seleccione un producto</option>
                        </select>
                    </div>

                    <div>
                        <label for="venta-cantidad" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Cantidad</label>
                        <input type="number" id="venta-cantidad" min="1" value="1" required class="mt-1 w-full p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500">
                    </div>

                    <div>
                        <label for="venta-precio-final" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Precio Unitario Final ($)</label>
                        <input type="number" id="venta-precio-final" min="0" step="0.01" required class="mt-1 w-full p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500">
                    </div>
                </div>
                
                <div>
                    <label for="venta-detalle" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Detalle de la Venta (Cliente, Descuento, etc.)</label>
                    <input type="text" id="venta-detalle" placeholder="Ej: Cliente Juan P茅rez, 10% descuento" class="mt-1 w-full p-2 border rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 dark:text-white dark:border-gray-500">
                </div>

                <div class="pt-2">
                    <button type="submit" class="w-full py-2 px-4 rounded-md shadow-md text-white bg-emerald-600 hover:bg-emerald-700 transition">
                        Confirmar Venta y Descontar Stock
                    </button>
                </div>
            </form>
        </section>

        <section id="sales-dashboard-section" class="dashboard-ventas grid grid-cols-2 lg:grid-cols-4 gap-4 hidden">
             <div class="card bg-white dark:bg-gray-700 p-5 rounded-xl shadow-lg border-b-4 border-emerald-500 dark:border-emerald-400">
                <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-300">Ventas Totales (#)</h3>
                <p id="stat-ventas-total" class="text-3xl font-bold mt-1 text-gray-800 dark:text-white">0</p>
            </div>
             <div class="card bg-white dark:bg-gray-700 p-5 rounded-xl shadow-lg border-b-4 border-emerald-700 dark:border-emerald-500">
                <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-300">Ingreso Total ($)</h3>
                <p id="stat-ingreso-total" class="text-3xl font-bold mt-1 text-gray-800 dark:text-white">$0.00</p>
            </div>
             <div class="card bg-white dark:bg-gray-700 p-5 rounded-xl shadow-lg border-b-4 border-yellow-500 dark:border-yellow-400">
                <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-300">Ventas de Hoy</h3>
                <p id="stat-ventas-hoy" class="text-3xl font-bold mt-1 text-gray-800 dark:text-white">0</p>
            </div>
             <div class="card bg-white dark:bg-gray-700 p-5 rounded-xl shadow-lg border-b-4 border-yellow-700 dark:border-yellow-500">
                <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-300">Ingreso de Hoy ($)</h3>
                <p id="stat-ingreso-hoy" class="text-3xl font-bold mt-1 text-gray-800 dark:text-white">$0.00</p>
            </div>
        </section>
        
        <div id="sales-charts-section" class="charts grid grid-cols-1 lg:grid-cols-2 gap-6 hidden">
            
            <div class="chart-card bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg">
                <h4 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Top 5 Productos m谩s Vendidos (Unidades)</h4>
                <div style="height:250px;">
                    <canvas id="chart-sales-top-products"></canvas>
                </div>
            </div>

            <div class="chart-card bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg">
                <h4 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Distribuci贸n de Ingresos por Mes</h4>
                <div style="height:250px;">
                    <canvas id="chart-sales-monthly-revenue"></canvas>
                </div>
            </div>
        </div>

        <section class="tabla-container bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg overflow-x-auto">
            <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">Historial de Ventas</h2>
            <table id="tabla-ventas" class="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
                <thead class="bg-gray-50 dark:bg-gray-800">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs text-gray-500 dark:text-gray-300 uppercase tracking-wider">Fecha</th>
                        <th class="px-6 py-3 text-left text-xs text-gray-500 dark:text-gray-300 uppercase tracking-wider">C贸digo/Producto</th>
                        <th class="px-6 py-3 text-right text-xs text-gray-500 dark:text-gray-300 uppercase tracking-wider">Cantidad</th>
                        <th class="px-6 py-3 text-right text-xs text-gray-500 dark:text-gray-300 uppercase tracking-wider">Precio Unitario</th>
                        <th class="px-6 py-3 text-right text-xs text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total Venta</th>
                        <th class="px-6 py-3 text-left text-xs text-gray-500 dark:text-gray-300 uppercase tracking-wider">Detalle</th>
                    </tr>
                </thead>
                <tbody class="bg-white dark:bg-gray-700 divide-y divide-gray-200 dark:divide-gray-600">
                </tbody>
            </table>
        </section>
    </div>

</main>

<script>
    const INVENTORY_STORAGE_KEY = 'inventoryData_v1';
    const SALES_STORAGE_KEY = 'salesData_v1';
    const USER_STORAGE_KEY = 'userData_v1'; 
    
    let charts = {}; 
    let currentTab = 'inventario'; 
    let currentUser = null; 
    
    const ROLES = {
        ADMIN: 'admin',
        EMPLOYEE: 'employee'
    };

    const PASSWORDS = {
        'Gior&Co2026*': { role: ROLES.ADMIN, username: 'Administrador' }, 
        'Gior2026*': { role: ROLES.EMPLOYEE, username: 'Trabajador' } 	
    };

    function showLoginModal() {
        document.getElementById('password-input').value = ''; 
        document.getElementById('login-modal').classList.remove('hidden');
        document.getElementById('app-content').classList.add('hidden');
        currentUser = null; 
        updateUIPermissions(); 
    }
    window.showLoginModal = showLoginModal; 

    function hideLoginModal() {
        document.getElementById('login-modal').classList.add('hidden');
        if (currentUser) {
            document.getElementById('app-content').classList.remove('hidden');
        }
    }

    function hideEditModal() {
        document.getElementById('edit-modal').classList.add('hidden');
    }
    window.hideEditModal = hideEditModal; 

    function handleLogin(e) {
        e.preventDefault();
        const password = document.getElementById('password-input').value.trim();
        
        const userConfig = PASSWORDS[password];

        if (userConfig) {
            currentUser = {
                username: userConfig.username,
                role: userConfig.role,
                id: crypto.randomUUID() 
            };

            hideLoginModal();
            loadInventoryAndRefreshUI();
            updateUIPermissions(); 
            showNotification(`Bienvenido, ${currentUser.username} (${currentUser.role === ROLES.ADMIN ? 'Admin' : 'Empleado'})`, 'info');
            
            if (currentTab === 'inventario') {
                showTab('inventario');
            } else {
                showTab('ventas');
            }
        } else {
            showNotification('Contrase帽a incorrecta. Int茅ntelo de nuevo.', 'error');
        }
    }

    function updateUIPermissions() {
        const isAdmin = currentUser?.role === ROLES.ADMIN;
        
        document.getElementById('current-user-info').textContent = currentUser ? `${currentUser.username} | ${isAdmin ? 'ADMIN' : 'EMPLEADO'}` : 'Sin sesi贸n';

        const addSection = document.getElementById('add-product-section');
        const chartsSection = document.getElementById('inventory-charts-section');
        const salesDashboardSection = document.getElementById('sales-dashboard-section');
        const salesChartsSection = document.getElementById('sales-charts-section');
        const actionsHeader = document.getElementById('acciones-header');
        
        if (addSection) addSection.classList.toggle('hidden', !isAdmin);
        if (chartsSection) chartsSection.classList.toggle('hidden', !isAdmin);
        if (salesDashboardSection) salesDashboardSection.classList.toggle('hidden', !isAdmin);
        if (salesChartsSection) salesChartsSection.classList.toggle('hidden', !isAdmin);
        if (actionsHeader) actionsHeader.style.display = isAdmin ? 'table-cell' : 'none'; 

        renderInventoryTable();
        renderSalesTable();
    }
    
    function showTab(tabName) {
        currentTab = tabName;
        document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
        document.getElementById(`module-${tabName}`).classList.remove('hidden');
        
        document.querySelectorAll('.tab-button').forEach(button => {
            button.classList.remove('tab-active');
            if (button.dataset.tab === tabName) {
                button.classList.add('tab-active');
            }
        });

        if (tabName === 'inventario') {
            loadInventoryAndRefreshUI();
        } else if (tabName === 'ventas') {
            populateSaleProductSelect();
            renderSalesTable(); 
            if (currentUser?.role === ROLES.ADMIN) {
                updateSalesDashboard();
                initSalesCharts();
            }
        }
    }

    function getInventory() {
        const data = localStorage.getItem(INVENTORY_STORAGE_KEY);
        return data ? JSON.parse(data) : [];
    }

    function saveInventory(inventory) {
        localStorage.setItem(INVENTORY_STORAGE_KEY, JSON.stringify(inventory));
    }

    function getSales() {
        const data = localStorage.getItem(SALES_STORAGE_KEY);
        return data ? JSON.parse(data) : [];
    }

    function saveSales(sales) {
        localStorage.setItem(SALES_STORAGE_KEY, JSON.stringify(sales));
    }

    function loadInventoryAndRefreshUI() {
        updateInventoryStats();
        applyFiltersAndRender();
        populateSaleProductSelect();
        if (currentUser?.role === ROLES.ADMIN) {
            initInventoryCharts();
        }
    }

    function showNotification(message, type = 'info') {
        const container = document.getElementById('notificaciones');
        const notification = document.createElement('div');
        
        let className = 'bg-info';
        if (type === 'success') className = 'bg-success';
        if (type === 'error') className = 'bg-error';

        notification.className = `notificacion-item ${className}`;
        notification.textContent = message;

        container.prepend(notification); 

        setTimeout(() => {
            notification.style.opacity = '0';
            setTimeout(() => notification.remove(), 500); 
        }, 5000); 
    }
    
    function formatCurrency(value) {
        return new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'USD' }).format(value);
    }
    
    function formatDate(isoString) {
        const date = new Date(isoString);
        return date.toLocaleDateString('es-CO', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    }

    function getStockStatus(cantidad) {
        if (cantidad === 0) return { text: 'Agotado', class: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300', filter: 'agotado' };
        if (cantidad <= 5) return { text: 'Bajo', class: 'bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-300', filter: 'bajo' };
        return { text: 'OK', class: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300', filter: 'ok' };
    }

    function updateInventoryStats() {
        const inventory = getInventory();
        let totalProducts = 0;
        let totalAgotados = 0;
        let totalBajo = 0;
        let totalValue = 0;

        inventory.forEach(p => {
            const cantidad = p.cantidad;
            totalProducts++;
            totalValue += cantidad * p.precio;
            
            if (cantidad === 0) {
                totalAgotados++;
            } else if (cantidad <= 5) {
                totalBajo++;
            }
        });

        document.getElementById('stat-total').textContent = inventory.length;
        document.getElementById('stat-agotados').textContent = totalAgotados;
        document.getElementById('stat-bajo').textContent = totalBajo;
        document.getElementById('stat-valor').textContent = formatCurrency(totalValue);
    }

    function updateSalesDashboard() {
        const sales = getSales();
        let totalVentas = sales.reduce((sum, sale) => sum + sale.cantidad, 0);
        let totalIngreso = sales.reduce((sum, sale) => sum + sale.totalVenta, 0);
        
        const today = new Date().toISOString().split('T')[0];
        const salesToday = sales.filter(sale => sale.fecha.startsWith(today));
        let totalVentasHoy = salesToday.reduce((sum, sale) => sum + sale.cantidad, 0);
        let totalIngresoHoy = salesToday.reduce((sum, sale) => sum + sale.totalVenta, 0);

        document.getElementById('stat-ventas-total').textContent = totalVentas;
        document.getElementById('stat-ingreso-total').textContent = formatCurrency(totalIngreso);
        document.getElementById('stat-ventas-hoy').textContent = totalVentasHoy;
        document.getElementById('stat-ingreso-hoy').textContent = formatCurrency(totalIngresoHoy);
    }

    function applyFiltersAndRender() {
        const inventory = getInventory();
        const searchText = document.getElementById('buscar').value.toLowerCase().trim();
        const filterTalla = document.getElementById('filtro-talla').value;
        const filterColor = document.getElementById('filtro-color').value.toLowerCase().trim();
        const filterStock = document.getElementById('filtro-stock').value;
        const filterPriceMin = parseFloat(document.getElementById('filtro-precio-min').value);
        const filterPriceMax = parseFloat(document.getElementById('filtro-precio-max').value);
        
        const filteredInventory = inventory.filter(p => {
            const stockStatus = getStockStatus(p.cantidad).filter;
            
            const matchesSearch = p.codigo.toLowerCase().includes(searchText) || 
                                  p.nombre.toLowerCase().includes(searchText);
            
            const matchesTalla = !filterTalla || p.talla === filterTalla;
            
            const matchesColor = !filterColor || p.color.toLowerCase().includes(filterColor);
            
            const matchesStock = !filterStock || stockStatus === filterStock;
            
            const matchesPriceMin = isNaN(filterPriceMin) || p.precio >= filterPriceMin;
            
            const matchesPriceMax = isNaN(filterPriceMax) || p.precio <= filterPriceMax;

            return matchesSearch && matchesTalla && matchesColor && matchesStock && matchesPriceMin && matchesPriceMax;
        });
        
        renderInventoryTable(filteredInventory);
    }
    
    function renderInventoryTable(inventory = getInventory()) {
        const tbody = document.getElementById('tabla-inventario').querySelector('tbody');
        tbody.innerHTML = '';
        const isAdmin = currentUser?.role === ROLES.ADMIN;
        
        inventory.forEach(p => {
            const row = tbody.insertRow();
            const status = getStockStatus(p.cantidad);

            row.className = 'hover:bg-gray-50 dark:hover:bg-gray-600 transition duration-150';

            row.insertCell().innerHTML = p.codigo;
            row.insertCell().innerHTML = p.nombre;
            row.insertCell().innerHTML = p.talla;
            row.insertCell().innerHTML = p.color;
            
            const cantidadCell = row.insertCell();
            cantidadCell.className = 'px-6 py-4 whitespace-nowrap text-right';
            cantidadCell.setAttribute('data-label', 'Cantidad');
            cantidadCell.innerHTML = `<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${status.class}">${p.cantidad}</span>`;

            row.insertCell().innerHTML = formatCurrency(p.precio);

            const actionsCell = row.insertCell();
            actionsCell.className = 'px-6 py-4 whitespace-nowrap text-center';
            actionsCell.setAttribute('data-label', 'Acciones');
            
            if (isAdmin) {
                actionsCell.style.display = 'table-cell';
                actionsCell.innerHTML = `
                    <button onclick="showEditModal('${p.id}')" class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-200 transition mr-3">
                        Editar
                    </button>
                    <button onclick="deleteProduct('${p.id}')" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 transition">
                        Eliminar
                    </button>
                `;
            } else {
                 actionsCell.style.display = 'none';
            }

            row.cells[0].setAttribute('data-label', 'C贸digo');
            row.cells[1].setAttribute('data-label', 'Nombre');
            row.cells[2].setAttribute('data-label', 'Talla');
            row.cells[3].setAttribute('data-label', 'Color');
            row.cells[5].setAttribute('data-label', 'Precio');
        });
    }

    function showEditModal(id) {
        const inventory = getInventory();
        const product = inventory.find(p => p.id === id);

        if (product) {
            document.getElementById('edit-id').value = product.id;
            document.getElementById('edit-codigo').value = product.codigo;
            document.getElementById('edit-nombre').value = product.nombre;
            document.getElementById('edit-talla').value = product.talla;
            document.getElementById('edit-color').value = product.color;
            document.getElementById('edit-cantidad').value = product.cantidad;
            document.getElementById('edit-precio').value = product.precio;

            document.getElementById('edit-modal').classList.remove('hidden');
        } else {
            showNotification('Producto no encontrado para editar.', 'error');
        }
    }
    window.showEditModal = showEditModal; 

    function handleAddProduct(e) {
        e.preventDefault();
        
        if (currentUser?.role !== ROLES.ADMIN) {
            showNotification('Permiso denegado. Solo Administradores pueden agregar productos.', 'error');
            return;
        }

        const codigo = document.getElementById('codigo').value.trim();
        const nombre = document.getElementById('nombre').value.trim();
        const talla = document.getElementById('talla').value;
        const color = document.getElementById('color').value.trim();
        const cantidad = parseInt(document.getElementById('cantidad').value);
        const precio = parseFloat(document.getElementById('precio').value);

        if (codigo && nombre && talla && color && !isNaN(cantidad) && cantidad >= 0 && !isNaN(precio) && precio >= 0) {
            let inventory = getInventory();
            
            const exists = inventory.some(p => p.codigo === codigo);

            if (!exists) {
                const newProduct = {
                    id: crypto.randomUUID(),
                    codigo: codigo,
                    nombre: nombre,
                    talla: talla,
                    color: color,
                    cantidad: cantidad,
                    precio: precio
                };

                inventory.push(newProduct);
                saveInventory(inventory);

                e.target.reset();

                showNotification('Producto agregado con 茅xito', 'success');
                loadInventoryAndRefreshUI();

            } else {
                showNotification('Error: El c贸digo de producto ya existe.', 'error');
            }
        }
    }

    function handleEditProduct(e) {
        e.preventDefault();
        const inventory = getInventory();
        
        const id = document.getElementById('edit-id').value;
        const nombre = document.getElementById('edit-nombre').value.trim();
        const talla = document.getElementById('edit-talla').value;
        const color = document.getElementById('edit-color').value.trim();
        const cantidad = parseInt(document.getElementById('edit-cantidad').value);
        const precio = parseFloat(document.getElementById('edit-precio').value).toFixed(2);

        if (isNaN(cantidad) || isNaN(precio) || cantidad < 0 || precio < 0) {
            showNotification('Cantidad o Precio no son v谩lidos.', 'error');
            return;
        }

        const index = inventory.findIndex(p => p.id === id);

        if (index !== -1) {
            inventory[index] = {
                id: id,
                codigo: inventory[index].codigo, 
                nombre: nombre,
                talla: talla,
                color: color,
                cantidad: cantidad,
                precio: parseFloat(precio)
            };

            saveInventory(inventory);
            hideEditModal();
            showNotification('Producto actualizado con 茅xito', 'success');
            loadInventoryAndRefreshUI();
        } else {
            showNotification('Error: Producto no encontrado.', 'error');
            hideEditModal();
        }
    }

    function deleteProduct(id) {
        if (currentUser?.role !== ROLES.ADMIN) {
            showNotification('Permiso denegado. Solo Administradores pueden eliminar.', 'error');
            return;
        }

        if (confirm('驴Est谩 seguro de que desea eliminar este producto del inventario?')) {
            let inventory = getInventory();
            const initialLength = inventory.length;
            inventory = inventory.filter(p => p.id !== id);

            if (inventory.length < initialLength) {
                saveInventory(inventory);
                showNotification('Producto eliminado con 茅xito', 'success');
                loadInventoryAndRefreshUI();
            } else {
                showNotification('Error al intentar eliminar el producto.', 'error');
            }
        }
    }
    window.deleteProduct = deleteProduct; 

    function handleRegisterSale(e) {
        e.preventDefault();
        
        const selectedOption = document.getElementById('venta-producto').value;
        const parts = selectedOption.split('|');
        if (parts.length !== 2) {
            showNotification('Seleccione un producto v谩lido.', 'error');
            return;
        }

        const idVendido = parts[0];
        const productoVendido = parts[1]; 

        const cantidadVendida = parseInt(document.getElementById('venta-cantidad').value);
        const precioUnitarioFinal = parseFloat(document.getElementById('venta-precio-final').value);
        const detalle = document.getElementById('venta-detalle').value.trim();

        if (isNaN(cantidadVendida) || cantidadVendida <= 0 || isNaN(precioUnitarioFinal) || precioUnitarioFinal < 0) {
            showNotification('Cantidad o Precio final no son v谩lidos.', 'error');
            return;
        }

        let inventory = getInventory();
        const index = inventory.findIndex(p => p.id === idVendido);

        if (index !== -1) {
            const producto = inventory[index];

            if (producto.cantidad < cantidadVendida) {
                showNotification(`Stock insuficiente. Solo quedan ${producto.cantidad} unidades.`, 'error');
                return;
            }

            producto.cantidad -= cantidadVendida;
            saveInventory(inventory);

            const totalVenta = cantidadVendida * precioUnitarioFinal;
            const sales = getSales();
            sales.push({
                id: crypto.randomUUID(),
                idProducto: idVendido,
                codigoProducto: producto.codigo, 
                nombreProducto: producto.nombre,
                cantidad: cantidadVendida,
                precioUnitario: precioUnitarioFinal,
                totalVenta: totalVenta,
                detalle: detalle,
                fecha: new Date().toISOString(),
                vendedor: currentUser.username
            });
            saveSales(sales);

            showNotification(`Venta registrada: ${cantidadVendida}x ${producto.nombre} por $${totalVenta.toFixed(2)}`, 'success');

            loadInventoryAndRefreshUI(); 
            renderSalesTable(); 

            e.target.reset();
            updateSaleFormPrice(producto.id);
        } else {
            showNotification('Error: Producto no encontrado en el inventario.', 'error');
        }
    }

    function updateSaleFormPrice(productId) {
        const inventory = getInventory();
        const product = inventory.find(p => p.id === productId);
        const priceInput = document.getElementById('venta-precio-final');

        if (product) {
            priceInput.value = product.precio.toFixed(2);
        } else {
            priceInput.value = '';
        }
    }

    function populateSaleProductSelect() {
        const select = document.getElementById('venta-producto');
        const inventory = getInventory();

        select.innerHTML = '<option value="">Seleccione un producto</option>';

        inventory.forEach(product => {
            const option = document.createElement('option');
            option.value = `${product.id}|${product.codigo}`;
            option.textContent = `${product.codigo} - ${product.nombre} (${product.talla}) [Stock: ${product.cantidad}]`;
            if (product.cantidad === 0) {
                option.disabled = true;
                option.textContent += ' - AGOTADO';
            }
            select.appendChild(option);
        });
        
        select.removeEventListener('change', handleSaleProductChange); 
        select.addEventListener('change', handleSaleProductChange);
        
        const initialValue = select.value;
        if (initialValue) {
            updateSaleFormPrice(initialValue.split('|')[0]);
        }
    }

    function handleSaleProductChange(e) {
        const selectedValue = e.target.value;
        const productId = selectedValue ? selectedValue.split('|')[0] : null;
        updateSaleFormPrice(productId);
    }
    
    function renderSalesTable() {
        const tbody = document.getElementById('tabla-ventas').querySelector('tbody');
        const sales = getSales().sort((a, b) => new Date(b.fecha) - new Date(a.fecha)); 
        tbody.innerHTML = '';

        sales.forEach(sale => {
            const row = tbody.insertRow();
            row.className = 'hover:bg-gray-50 dark:hover:bg-gray-600 transition duration-150';

            row.insertCell().innerHTML = formatDate(sale.fecha);
            row.insertCell().innerHTML = `${sale.codigoProducto} - ${sale.nombreProducto} (Vendedor: ${sale.vendedor})`;
            row.insertCell().innerHTML = sale.cantidad;
            row.insertCell().innerHTML = formatCurrency(sale.precioUnitario);
            row.insertCell().innerHTML = formatCurrency(sale.totalVenta);
            row.insertCell().innerHTML = sale.detalle || '-';
            
            row.cells[0].setAttribute('data-label', 'Fecha');
            row.cells[1].setAttribute('data-label', 'Producto');
            row.cells[2].setAttribute('data-label', 'Cantidad');
            row.cells[3].setAttribute('data-label', 'Precio Unitario');
            row.cells[4].setAttribute('data-label', 'Total Venta');
            row.cells[5].setAttribute('data-label', 'Detalle');
        });
    }

    function createChart(ctxId, type, data, options) {
        if (charts[ctxId]) {
            charts[ctxId].destroy();
        }
        const ctx = document.getElementById(ctxId).getContext('2d');
        charts[ctxId] = new Chart(ctx, { type, data, options });
    }

    function initInventoryCharts() {
        if (currentUser?.role !== ROLES.ADMIN) return;

        const inventory = getInventory();
        let agotados = 0;
        let bajo = 0;
        let ok = 0;

        inventory.forEach(p => {
            if (p.cantidad === 0) agotados++;
            else if (p.cantidad <= 5) bajo++;
            else ok++;
        });

        const pieData = {
            labels: ['Stock OK', 'Stock Bajo ( 5)', 'Agotados'],
            datasets: [{
                data: [ok, bajo, agotados],
                backgroundColor: ['#10b981', '#f59e0b', '#ef4444'], 
                hoverOffset: 4
            }]
        };

        const pieOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'right', labels: { color: document.body.classList.contains('dark') ? 'white' : 'black' } },
                title: { display: false }
            }
        };

        createChart('chart-stock-pie', 'doughnut', pieData, pieOptions);
        
        const topSelling = getInventory()
            .sort((a, b) => b.cantidad - a.cantidad) 
            .slice(0, 5);

        const barData = {
            labels: topSelling.map(p => p.nombre),
            datasets: [{
                label: 'Stock Actual',
                data: topSelling.map(p => p.cantidad),
                backgroundColor: '#3b82f6', 
            }]
        };

        const barOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                title: { display: false }
            },
            scales: {
                y: { beginAtZero: true, ticks: { color: document.body.classList.contains('dark') ? 'white' : 'black' } },
                x: { ticks: { color: document.body.classList.contains('dark') ? 'white' : 'black' } }
            }
        };

        createChart('chart-top-bar', 'bar', barData, barOptions);
    }
    
    function initSalesCharts() {
        if (currentUser?.role !== ROLES.ADMIN) return;
        const sales = getSales();
        
        const salesByProduct = sales.reduce((acc, sale) => {
            const key = `${sale.codigoProducto} - ${sale.nombreProducto}`;
            acc[key] = (acc[key] || 0) + sale.cantidad;
            return acc;
        }, {});
        
        const sortedSales = Object.entries(salesByProduct)
            .sort(([, a], [, b]) => b - a)
            .slice(0, 5);

        const topProductsData = {
            labels: sortedSales.map(([name]) => name),
            datasets: [{
                label: 'Unidades Vendidas',
                data: sortedSales.map(([, count]) => count),
                backgroundColor: '#10b981', 
            }]
        };
        
        const topProductsOptions = {
            responsive: true,
            maintainAspectRatio: false,
            indexAxis: 'y', 
            plugins: {
                legend: { display: false },
            },
            scales: {
                x: { beginAtZero: true, ticks: { color: document.body.classList.contains('dark') ? 'white' : 'black' } },
                y: { ticks: { color: document.body.classList.contains('dark') ? 'white' : 'black' } }
            }
        };

        createChart('chart-sales-top-products', 'bar', topProductsData, topProductsOptions);

        const monthlyRevenue = sales.reduce((acc, sale) => {
            const date = new Date(sale.fecha);
            const monthYear = date.toLocaleString('es-CO', { month: 'short', year: 'numeric' });
            acc[monthYear] = (acc[monthYear] || 0) + sale.totalVenta;
            return acc;
        }, {});
        
        const monthlyRevenueData = {
            labels: Object.keys(monthlyRevenue),
            datasets: [{
                label: 'Ingresos ($)',
                data: Object.values(monthlyRevenue),
                borderColor: '#f59e0b', 
                backgroundColor: 'rgba(245, 158, 11, 0.2)', 
                fill: true,
                tension: 0.1
            }]
        };

        const monthlyRevenueOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
            },
            scales: {
                y: { beginAtZero: true, ticks: { color: document.body.classList.contains('dark') ? 'white' : 'black' } },
                x: { ticks: { color: document.body.classList.contains('dark') ? 'white' : 'black' } }
            }
        };

        createChart('chart-sales-monthly-revenue', 'line', monthlyRevenueData, monthlyRevenueOptions);
    }
    
    function toggleDarkMode() {
        const isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
        document.getElementById('dark-mode-label').textContent = isDark ? 'Light' : 'Dark';
        
        const dot = document.querySelector('#toggle-dark .dot');
        dot.classList.toggle('mr-2', !isDark); 
        dot.classList.toggle('ml-auto', isDark); 

        if (currentUser?.role === ROLES.ADMIN) {
            if (currentTab === 'inventario') initInventoryCharts();
            if (currentTab === 'ventas') initSalesCharts();
        }
    }

    function init() {
        const darkModeEnabled = localStorage.getItem('darkMode') === 'enabled';
        if (darkModeEnabled) {
            document.documentElement.classList.add('dark');
            document.getElementById('dark-mode-label').textContent = 'Light';
            const dot = document.querySelector('#toggle-dark .dot');
            dot.classList.add('ml-auto');
            dot.classList.remove('mr-2');
        } else {
            document.getElementById('dark-mode-label').textContent = 'Dark';
        }
        
        document.getElementById('toggle-dark').addEventListener('click', toggleDarkMode);
        
        document.getElementById('form-login').addEventListener('submit', handleLogin);
        document.getElementById('form-producto').addEventListener('submit', handleAddProduct);
        document.getElementById('form-editar-producto').addEventListener('submit', handleEditProduct);
        document.getElementById('form-venta').addEventListener('submit', handleRegisterSale);

        document.getElementById('buscar').addEventListener('input', applyFiltersAndRender);
        document.getElementById('filtro-talla').addEventListener('change', applyFiltersAndRender);
        document.getElementById('filtro-color').addEventListener('input', applyFiltersAndRender);
        document.getElementById('filtro-stock').addEventListener('change', applyFiltersAndRender);
        document.getElementById('filtro-precio-min').addEventListener('input', applyFiltersAndRender);
        document.getElementById('filtro-precio-max').addEventListener('input', applyFiltersAndRender);
        document.getElementById('limpiar-filtros').addEventListener('click', () => {
            document.getElementById('buscar').value = '';
            document.getElementById('filtro-talla').value = '';
            document.getElementById('filtro-color').value = '';
            document.getElementById('filtro-stock').value = '';
            document.getElementById('filtro-precio-min').value = '';
            document.getElementById('filtro-precio-max').value = '';
            applyFiltersAndRender();
        });

        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', (e) => showTab(e.target.dataset.tab));
        });

        const initialUser = localStorage.getItem(USER_STORAGE_KEY);
        if (initialUser) {
            currentUser = JSON.parse(initialUser);
            hideLoginModal();
            loadInventoryAndRefreshUI();
            updateUIPermissions();
            showTab('inventario');
        } else {
            showLoginModal();
        }
    }

    window.addEventListener('load', init);
</script>
</body>
</html>